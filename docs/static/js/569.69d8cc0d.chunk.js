(()=>{"use strict";var e={569:(e,o,t)=>{var r=t(51);function n(e){const o=e.charAt(0),t=parseInt(e.charAt(1));return[o.charCodeAt(0)-"a".charCodeAt(0)+1,t]}const a=function(e,o,t,a){if(e[t.url])return e;const s={arrows:[],notes:"No notes found."};let l=new r.qQ;l.loadPgn(t.pgn);let i=l.header().Black===a,c=!1,f=[],p=0,h=new r.qQ,u=!1,d="";const g={};for(let b=0;b<l.history().length;b++){d=h.fen();let e=h.move(l.history()[b]),t=h.fen();if(o[t]&&(u=!0),u&&!o[t]){let t=o[d]||[];p=b,f=[...t.map((e=>{let o;return g[e]?(o=g[e],o=o.history().slice(b,b+1)):(o=new r.qQ,o.loadPgn(e),g[e]=o,o=o.history().slice(b,b+1)),o&&o.length>0?o[0]:"oops"})).filter((e=>"oops"!==e))],c=!0,s.foundIntersection=!0;let[a,l]=n(e.from),[h,u]=n(e.to);s.invert_board=i,i&&(u=9-u,l=9-l,h=9-h,a=9-a);let v={color:"red",fromX:a,fromY:l,destX:h,destY:u,san:e.san};s.arrows.push(v);break}}c&&(f=[...new Set(f)]),f.forEach((e=>{let o,t=new r.qQ(d);try{o=t.move(e)}catch(h){return console.log("e",h),console.log(e),console.log(t.ascii()),""}let[a,l]=n(o.from),[c,f]=n(o.to);i&&(f=9-f,l=9-l,c=9-c,a=9-a);const p={color:"green",fromX:a,fromY:l,destX:c,destY:f,moveSan:o.san};s.arrows.push(p)}));let v=new r.qQ(d);c||(v.loadPgn(t.pgn),d=t.pgn);let y="No advice found.";s.result=l.header().Result,s.finalMoveIndex=p,s.fen_at_departure=v.fen(),s.you_left_book=c&&("w"===v.turn()?l.header().White===a:l.header().Black===a),y=c?s.you_left_book?"You left book on this one. Study the lines from the repertoire.":"They left book. Consider analyzing the move to get an idea of how to play against it.":"This position was not found in the repertoire. Consider expanding it for the below opening name.",s.advice=y,s.displayFEN=v.fen(),s.headers=l.header();const m=new URL(s.headers.ECOUrl).pathname.split("/").pop().replace(/-/g," ").replace(/[0-9].*/g,"");return s.openingFamily=m,e[t.url]=s,s};console.log("Worker is running");let s=async e=>{let{data:{analysisDatabase:o,repertoire:t,games:r,playerName:n}}=e,s="object"===typeof o?o:{};if("object"!==typeof t||0===Object.keys(t).length)return void console.log("No repertoire to work with.");console.log("Starting to process "+r.length+" games.");let l=0;for(let i of r){l++;let o=a(s,t,i,n);s[i.url]=o,l>0&&l%10===0&&e.target.postMessage({action:"SET_ANALYSIS_DATABASE",currentAnalysisDatabase:s})}e.target.postMessage({action:"SET_ANALYSIS_DATABASE",currentAnalysisDatabase:s}),console.log("Completed analysis")};self.onchange=s,self.onmessage=s}},o={};function t(r){var n=o[r];if(void 0!==n)return n.exports;var a=o[r]={exports:{}};return e[r](a,a.exports,t),a.exports}t.m=e,t.x=()=>{var e=t.O(void 0,[51],(()=>t(569)));return e=t.O(e)},(()=>{var e=[];t.O=(o,r,n,a)=>{if(!r){var s=1/0;for(f=0;f<e.length;f++){r=e[f][0],n=e[f][1],a=e[f][2];for(var l=!0,i=0;i<r.length;i++)(!1&a||s>=a)&&Object.keys(t.O).every((e=>t.O[e](r[i])))?r.splice(i--,1):(l=!1,a<s&&(s=a));if(l){e.splice(f--,1);var c=n();void 0!==c&&(o=c)}}return o}a=a||0;for(var f=e.length;f>0&&e[f-1][2]>a;f--)e[f]=e[f-1];e[f]=[r,n,a]}})(),t.d=(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((o,r)=>(t.f[r](e,o),o)),[])),t.u=e=>"static/js/"+e+".f3c1e8dc.chunk.js",t.miniCssF=e=>{},t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),t.p="/book-it/",(()=>{var e={569:1};t.f.i=(o,r)=>{e[o]||importScripts(t.p+t.u(o))};var o=self.webpackChunkbook_it=self.webpackChunkbook_it||[],r=o.push.bind(o);o.push=o=>{var n=o[0],a=o[1],s=o[2];for(var l in a)t.o(a,l)&&(t.m[l]=a[l]);for(s&&s(t);n.length;)e[n.pop()]=1;r(o)}})(),(()=>{var e=t.x;t.x=()=>t.e(51).then(e)})();t.x()})();
//# sourceMappingURL=569.69d8cc0d.chunk.js.map