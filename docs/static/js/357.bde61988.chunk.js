(()=>{"use strict";var e={357:(e,o,t)=>{var r=t(51);const n=new(t(447).ZP)("AppDatabase");function a(e){const o=e.charAt(0),t=parseInt(e.charAt(1));return[o.charCodeAt(0)-"a".charCodeAt(0)+1,t]}n.version(1).stores({objectCache:"++id, key, value"});const s=function(e,o,t,n){if(e[t.url])return e;const s={arrows:[],notes:"No notes found."};let l=new r.qQ;l.loadPgn(t.pgn);let i=l.header().Black===n,c=!1,p=[],f=0,h=new r.qQ,u=!1,d="";const g={};for(let k=0;k<l.history().length;k++){d=h.fen();let e=h.move(l.history()[k]),t=h.fen();if(o[t]&&(u=!0),u&&!o[t]){let t=o[d]||[];f=k,p=[...t.map((e=>{let o;return g[e]?(o=g[e],o=o.history().slice(k,k+1)):(o=new r.qQ,o.loadPgn(e),g[e]=o,o=o.history().slice(k,k+1)),o&&o.length>0?o[0]:"oops"})).filter((e=>"oops"!==e))],c=!0,s.foundIntersection=!0;let[n,l]=a(e.from),[h,u]=a(e.to);s.invert_board=i,i&&(u=9-u,l=9-l,h=9-h,n=9-n);let v={color:"red",fromX:n,fromY:l,destX:h,destY:u,san:e.san};s.arrows.push(v);break}}c&&(p=[...new Set(p)]);let v=p.map((e=>{let o,t=new r.qQ(d);try{o=t.move(e)}catch(h){return console.log("e",h),console.log(e),console.log(t.ascii()),""}let[n,l]=a(o.from),[c,p]=a(o.to);i&&(p=9-p,l=9-l,c=9-c,n=9-n);const f={color:"green",fromX:n,fromY:l,destX:c,destY:p,moveSan:o.san};s.arrows.push(f)})),y=new r.qQ(d);c||(y.loadPgn(t.pgn),d=t.pgn),v.push(undefined);let m="No advice found.";s.result=l.header().Result,s.fen_at_departure=y.fen(),s.you_left_book=c&&("w"===y.turn()?l.header().White===n:l.header().Black===n),m=c?s.you_left_book?"You left book on this one. Study the lines from the repertoire.":"They left book. Consider analyzing the move to get an idea of how to play against it.":"This position was not found in the repertoire. Consider expanding it for the below opening name.",s.advice=m,s.displayFEN=y.fen(),s.headers=l.header();const b=new URL(s.headers.ECOUrl).pathname.split("/").pop().replace(/-/g," ").replace(/[0-9].*/g,"");return s.openingFamily=b,e[t.url]=s,s};console.log("Worker is running");let l=async e=>{let{data:{analysisDatabase:o,repertoire:t,games:r,playerName:n}}=e,a="object"===typeof o?o:{};if("object"!==typeof t||0===Object.keys(t).length)return void console.log("No repertoire to work with.");console.log("Starting to process "+r.length+" games.");let l=0;for(let i of r){l++,console.time("calculateAnalysis");let o=s(a,t,i,n);console.timeEnd("calculateAnalysis"),a[i.url]=o,l>0&&l%10===0&&(console.log(l),e.target.postMessage({action:"SET_ANALYSIS_DATABASE",currentAnalysisDatabase:a}))}e.target.postMessage({action:"SET_ANALYSIS_DATABASE",currentAnalysisDatabase:a})};self.onchange=l,self.onmessage=l}},o={};function t(r){var n=o[r];if(void 0!==n)return n.exports;var a=o[r]={exports:{}};return e[r](a,a.exports,t),a.exports}t.m=e,t.x=()=>{var e=t.O(void 0,[416],(()=>t(357)));return e=t.O(e)},(()=>{var e=[];t.O=(o,r,n,a)=>{if(!r){var s=1/0;for(p=0;p<e.length;p++){r=e[p][0],n=e[p][1],a=e[p][2];for(var l=!0,i=0;i<r.length;i++)(!1&a||s>=a)&&Object.keys(t.O).every((e=>t.O[e](r[i])))?r.splice(i--,1):(l=!1,a<s&&(s=a));if(l){e.splice(p--,1);var c=n();void 0!==c&&(o=c)}}return o}a=a||0;for(var p=e.length;p>0&&e[p-1][2]>a;p--)e[p]=e[p-1];e[p]=[r,n,a]}})(),t.d=(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((o,r)=>(t.f[r](e,o),o)),[])),t.u=e=>"static/js/"+e+".eeba4c39.chunk.js",t.miniCssF=e=>{},t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),t.p="/book-it/",(()=>{var e={357:1};t.f.i=(o,r)=>{e[o]||importScripts(t.p+t.u(o))};var o=self.webpackChunkbook_it=self.webpackChunkbook_it||[],r=o.push.bind(o);o.push=o=>{var n=o[0],a=o[1],s=o[2];for(var l in a)t.o(a,l)&&(t.m[l]=a[l]);for(s&&s(t);n.length;)e[n.pop()]=1;r(o)}})(),(()=>{var e=t.x;t.x=()=>t.e(416).then(e)})();t.x()})();
//# sourceMappingURL=357.bde61988.chunk.js.map